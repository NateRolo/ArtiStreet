<html>

<head> </head>

<body>
  <style>
    img {
      height: 200px;
      width: 200px;
      border: 2px solid black;
    }
  </style>
  Image Name <input id="namebox" type="text" /><br /><br />
  <img id="myimg" /> <label id="UpProgress"></label><br /><br />

  <button id="select">select</button>
  <button id="upload">upload</button>
  <button id="retrieve">retrieve</button>

  <!-- FIREBASE -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <script id="MainScript">
    var ImgName, ImgURL;
    var files = []; // Declare files as an array
    var reader;

    // var firebaseConfig = {
    //   apiKey: "AIzaSyBPz_uJEJn17ld3tEuoGTNgouSrmzjsccg",
    //   authDomain: "comp-1800-bby-31.firebaseapp.com",
    //   projectId: "comp-1800-bby-31",
    //   storageBucket: "comp-1800-bby-31.appspot.com",
    //   messagingSenderId: "698245109532",
    //   appId: "1:698245109532:web:38908fdd53d396a91f4cd9",
    // };

    //--------------------------------------------
    // initialize the Firebase app
    //--------------------------------------------
    // const app = firebase.initializeApp(firebaseConfig);

    // Selection of image
    document.getElementById("select").onclick = function (e) {
      var input = document.createElement("input");
      input.type = "file";

      input.onchange = (e) => {
        files = e.target.files;
        reader = new FileReader();
        reader.onload = function () {
          document.getElementById("myimg").src = reader.result;
        };
        reader.readAsDataURL(files[0]);
      };
      input.click();
    };

    // Uploading image to Firebase Storage and Database
    document.getElementById("upload").onclick = function () {
      ImgName = document.getElementById("namebox").value;
      var uploadTask = firebase
        .storage()
        .ref("Images/" + ImgName + ".png")
        .put(files[0]);

      // Track the upload progress
      uploadTask.on(
        "state_changed",
        function (snapshot) {
          var progress =
            (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
          document.getElementById("UpProgress").innerHTML =
            "Upload " + progress.toFixed(2) + "%";
        },
        function (error) {
          // Handle errors
          alert("Error in saving image: " + error.message);
        },
        function () {
          // On successful upload
          uploadTask.snapshot.ref.getDownloadURL().then(function (url) {
            ImgURL = url; // Get the image URL
            // Store the image details in Firebase Realtime Database
            firebase
              .database()
              .ref("Pictures/" + ImgName)
              .set({
                Name: ImgName,
                Link: ImgURL,
              })
              .then(function () {
                alert("Image added successfully");
              })
              .catch(function (error) {
                alert("Error storing image in database: " + error.message);
              });
          });
        }
      );
    };
  </script>

  <script src="./scripts/firebaseAPI_TEAMBBY31.js"></script>
</body>

</html>